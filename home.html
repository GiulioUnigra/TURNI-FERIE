<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Home - Gestione Ferie</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f4fcf4;
      padding: 20px;
    }
    h2 {
      text-align: center;
    }
    .scheda {
      background: #fff;
      padding: 20px;
      border-radius: 10px;
      max-width: 600px;
      margin: auto;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    .riga {
      margin-bottom: 10px;
    }
    .etichetta {
      font-weight: bold;
    }
    .moduli {
      margin-top: 30px;
      text-align: center;
    }
    .moduli a {
      margin: 5px;
      display: inline-block;
      background: #4CAF50;
      color: white;
      padding: 10px 20px;
      border-radius: 6px;
      text-decoration: none;
    }
    .moduli a:hover {
      background: #45a049;
    }
    .logout {
      position: absolute;
      top: 20px;
      left: 20px;
      background-color: #4CAF50;
      color: white;
      padding: 8px 16px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
  </style>
</head>
<body>

  <button class="logout" onclick="logout()">Logout</button>
  <h2>Benvenuto</h2>

  <div class="scheda" id="scheda-utente">
    <div class="riga"><span class="etichetta">Nome:</span> <span id="nome"></span></div>
    <div class="riga"><span class="etichetta">Email:</span> <span id="email"></span></div>
    <div class="riga"><span class="etichetta">Gruppo:</span> <span id="gruppo"></span></div>
    <div class="riga"><span class="etichetta">Ruolo:</span> <span id="ruolo"></span></div>
    <div class="riga"><span class="etichetta">Tipo Turno:</span> <span id="turno"></span></div>
    <div class="riga"><span class="etichetta">Ore Accumulate:</span> <span id="accumulate"></span></div>
    <div class="riga"><span class="etichetta">Monte Ore Annuali:</span> <span id="annuali"></span></div>
  </div>

  <div class="moduli" id="moduli-accesso" style="display:none;">
    <a href="riepilogo.html">Riepilogo Dipendenti</a>
    <a href="gestione_dipendenti.html">Gestione Dipendenti</a>
    <a href="richiesta_ferie.html">Richiesta Ferie</a>
    <a href="approvazione.html">Approvazione Ferie</a>
    <a href="gestione_turni.html">Gestione Turni</a>
    <a href="calendario.html">Calendario</a>
    <a href="appunti.html">Appunti</a>
    <a href="archiviazione.html">Archiviazione</a>
  </div>

  <script type="module">
    import { createClient } from 'https://esm.sh/@supabase/supabase-js@2'

    const supabase = createClient(
      'https://lmcawwcrwqtmylhcbqwi.supabase.co',
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxtY2F3d2Nyd3F0bXlsaGNicXdpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTMxMDE1MDgsImV4cCI6MjA2ODY3NzUwOH0.mR9jK7S9Bkdf75XqLcMKj7nvRFqmMWLj9Km2QZ6uluE'
    )

    const utente = JSON.parse(localStorage.getItem("utenteLoggato"));
    if (!utente) {
      window.location.href = "index.html";
    }

    async function mostraPersonale() {
      const { data, error } = await supabase
        .from("dipendenti")
        .select("*")
        .eq("email", utente.email);

      if (error || !data || data.length === 0) {
        console.error("Errore caricamento dati:", error);
        return;
      }

      const d = data[0];
      document.getElementById("nome").innerText = d.nome;
      document.getElementById("email").innerText = d.email;
      document.getElementById("gruppo").innerText = d.gruppo;
      document.getElementById("ruolo").innerText = d.ruolo;
      document.getElementById("turno").innerText = d.tipo_turno || 'Standard';
      document.getElementById("accumulate").innerText = d.ore_accumulate || 0;
      document.getElementById("annuali").innerText = d.ore_annuali || 0;

      if (["Responsabile", "Viceresponsabile", "Referente"].includes(d.ruolo)) {
        document.getElementById("moduli-accesso").style.display = "block";
      }
    }

    mostraPersonale();

    function logout() {
      localStorage.removeItem("utenteLoggato");
      window.location.href = "index.html";
    }
  </script>
</body>
</html>
